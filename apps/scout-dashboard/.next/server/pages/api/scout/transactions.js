"use strict";(()=>{var e={};e.id=459,e.ids=[459],e.modules={9424:e=>{e.exports=require("mssql")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2905:(e,r,a)=>{a.r(r),a.d(r,{config:()=>d,default:()=>u,routeModule:()=>l});var t={};a.r(t),a.d(t,{config:()=>c,default:()=>handler});var s=a(9150),n=a(1631),o=a(6835),i=a(9747);async function handler(e,r){if("GET"!==e.method)return r.status(405).json({error:"Method not allowed"});try{let{store_ids:a,brands:t,categories:s,date_start:n,date_end:o,time_of_day:c,age_brackets:u,genders:d,municipalities:l,min_amount:m,max_amount:p,limit:_="1000",offset:y="0",sort_by:g="TransactionDate",sort_order:A="desc"}=e.query,f={};a&&(f.store_ids=Array.isArray(a)?a.map(String):[String(a)]),t&&(f.brands=Array.isArray(t)?t:[t]),s&&(f.categories=Array.isArray(s)?s:[s]),n&&o&&(f.date_range={start:n,end:o}),c&&(f.time_of_day=Array.isArray(c)?c:[c]),u&&(f.age_brackets=Array.isArray(u)?u:[u]),d&&(f.genders=Array.isArray(d)?d:[d]),l&&(f.municipalities=Array.isArray(l)?l:[l]),m&&(f.min_amount=parseFloat(m)),p&&(f.max_amount=parseFloat(p));let h={limit:Math.min(parseInt(_),1e4),offset:parseInt(y),sort_by:g,sort_order:A},S=await i.jv.getTransactions(f,h);return r.setHeader("Cache-Control","no-store, no-cache, must-revalidate"),r.setHeader("X-Query-Time",S.performance?.query_time_ms?.toString()||"0"),r.setHeader("X-Row-Count",S.performance?.row_count?.toString()||"0"),S.cache?.hit?r.setHeader("X-Cache-Status","HIT"):r.setHeader("X-Cache-Status","MISS"),r.status(200).json(S)}catch(e){return console.error("Error in /api/scout/transactions:",e),r.status(500).json({error:"Internal server error",message:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()})}}let c={api:{externalResolver:!0}},u=(0,o.l)(t,"default"),d=(0,o.l)(t,"config"),l=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/scout/transactions",pathname:"/api/scout/transactions",bundlePath:"",filename:""},userland:t})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),a=r.X(0,[471,747],()=>__webpack_exec__(2905));module.exports=a})();