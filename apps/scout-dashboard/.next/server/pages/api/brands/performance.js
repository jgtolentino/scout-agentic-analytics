"use strict";(()=>{var e={};e.id=253,e.ids=[253],e.modules={9424:e=>{e.exports=require("mssql")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6424:(e,a,r)=>{r.r(a),r.d(a,{config:()=>p,default:()=>d,routeModule:()=>c});var t={};r.r(t),r.d(t,{default:()=>handler});var n=r(9150),i=r(1631),o=r(6835),s=r(9747);async function handler(e,a){if("GET"!==e.method)return a.status(405).json({error:"Method not allowed"});a.setHeader("Cache-Control","no-store, no-cache, must-revalidate"),a.setHeader("Content-Type","application/json");try{let{date_start:r,date_end:t,store_ids:n,municipalities:i,compare_periods:o="false"}=e.query,d={};r&&t&&(d.date_range={start:r,end:t}),n&&(d.store_ids=Array.isArray(n)?n.map(String):[String(n)]),i&&(d.municipalities=Array.isArray(i)?i:[i]);let p=await s.jv.getBrandPerformance(d);if("true"===o&&d.date_range){let e=new Date(d.date_range.start),a=new Date(d.date_range.end),r=a.getTime()-e.getTime(),t=new Date(e.getTime()-r),n=new Date(e.getTime()-1),i={...d,date_range:{start:t.toISOString().split("T")[0],end:n.toISOString().split("T")[0]}},o=await s.jv.getBrandPerformance(i);p.data&&o.data&&(p.data=p.data.map(e=>{let a=o.data?.find(a=>a.brand_name===e.brand_name);return a?{...e,comparison:{revenue_change:(e.avg_price_php-a.avg_price_php)/a.avg_price_php*100,transaction_change:0,customer_change:(e.consumer_reach_points-a.consumer_reach_points)/a.consumer_reach_points*100,avg_value_change:(e.avg_price_php-a.avg_price_php)/a.avg_price_php*100}}:e})),p.comparison_period={current:d.date_range,previous:i.date_range}}return a.status(200).json(p)}catch(e){return console.error("Brand performance endpoint error:",e),a.status(500).json({ok:!1,error:"Brand performance analysis failed",message:e instanceof Error?e.message:"Unknown error",timestamp:new Date().toISOString()})}}let d=(0,o.l)(t,"default"),p=(0,o.l)(t,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/brands/performance",pathname:"/api/brands/performance",bundlePath:"",filename:""},userland:t})}};var a=require("../../../webpack-api-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),r=a.X(0,[471,747],()=>__webpack_exec__(6424));module.exports=r})();