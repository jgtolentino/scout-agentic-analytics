"use strict";(()=>{var e={};e.id=405,e.ids=[405,888,660],e.modules={2056:(e,s,t)=>{t.r(s),t.d(s,{config:()=>E,default:()=>F,getServerSideProps:()=>T,getStaticPaths:()=>L,getStaticProps:()=>I,reportWebVitals:()=>O,routeModule:()=>Q,unstable_getServerProps:()=>M,unstable_getServerSideProps:()=>R,unstable_getStaticParams:()=>z,unstable_getStaticPaths:()=>Z,unstable_getStaticProps:()=>U});var a={};t.r(a),t.d(a,{default:()=>pages});var r=t(8877),i=t(4591),n=t(6021),l=t(1938),d=t.n(l),o=t(8025),c=t(997),x=t(6689),m=t.n(x),h=t(968),u=t.n(h),g=t(8910),p=t(8205),j=t(2908),y=t(5484),b=t(5556),v=t(3131),f=t(1154),_=t(5734),N=t(3004),w=t(739),S=t(171),q=t(3454),C=t(7513),k=t(1011),P=t(6026),D=t(790),K=t(8635),B=t(5490),$=t(4288);let TransactionDashboard=()=>{let[e,s]=(0,x.useState)({date_range:{start:new Date(Date.now()-2592e6).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},store_ids:["102","103","104","109","110","112"]}),[t,a]=(0,x.useState)("overview"),{data:r,isLoading:i,error:n}=(0,g.useQuery)({queryKey:["scout-transactions",e],queryFn:async()=>{let s=new URLSearchParams;e.store_ids?.length&&s.append("store_ids",e.store_ids.join(",")),e.brands?.length&&s.append("brands",e.brands.join(",")),e.categories?.length&&s.append("categories",e.categories.join(",")),e.date_range&&(s.append("date_start",e.date_range.start),s.append("date_end",e.date_range.end)),s.append("limit","5000");let t=await fetch(`/api/scout/transactions?${s}`,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Failed to fetch transactions");return t.json()},refetchInterval:3e5,staleTime:24e4}),{data:l,isLoading:d}=(0,g.useQuery)({queryKey:["scout-kpis",e],queryFn:async()=>{let s=new URLSearchParams;e.store_ids?.length&&s.append("store_ids",e.store_ids.join(",")),e.categories?.length&&s.append("categories",e.categories.join(",")),e.date_range&&(s.append("date_start",e.date_range.start),s.append("date_end",e.date_range.end));let t=await fetch(`/api/transactions/kpis?${s}`,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Failed to fetch KPIs");return t.json()},refetchInterval:3e5}),o=m().useMemo(()=>{if(!r?.data)return null;let e=r.data,s=e.reduce((e,s)=>{let t=s.date_ph;return e[t]||(e[t]={date:t,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),t=Object.values(s).map(e=>({...e,customers:e.customers.size})).sort((e,s)=>e.date.localeCompare(s.date)),a=e.reduce((e,s)=>{let t=s.brand||"Unknown";return e[t]||(e[t]={brand:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),i=Object.values(a).sort((e,s)=>s.sales-e.sales).slice(0,10),n=e.reduce((e,s)=>{let t=s.store_id||"Unknown",a=s.store_name||`Store ${t}`;return e[t]||(e[t]={store_id:t,store_name:a,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),l=Object.values(n).map(e=>({...e,customers:e.customers.size,avg_transaction:e.sales/e.transactions})).sort((e,s)=>s.sales-e.sales),d=e.reduce((e,s)=>{let t=s.time_of_day||"Unknown";return e[t]||(e[t]={time_of_day:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),o=Object.values(d);return{timeSeries:t,brands:i,stores:l,timeOfDay:o}},[r]),h=["#0066CC","#FF6B35","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#2C3E50"];return i||d?c.jsx("div",{className:"flex items-center justify-center h-96",children:c.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-scout-primary"})}):n?(0,c.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[c.jsx("h3",{className:"text-red-800 font-medium",children:"Error Loading Data"}),c.jsx("p",{className:"text-red-600 text-sm mt-1",children:n instanceof Error?n.message:"Unknown error occurred"})]}):(0,c.jsxs)("div",{className:"space-y-6","data-testid":"transaction-dashboard",children:[c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Scout v7 Analytics"}),c.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time transaction analytics and customer insights"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[(0,c.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[c.jsx(P.Z,{className:"w-4 h-4 mr-1"}),e.date_range?.start," to ",e.date_range?.end]}),(0,c.jsxs)("button",{className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:[c.jsx(D.Z,{className:"w-4 h-4 mr-1"}),"Filters"]})]})]})}),l?.data&&(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[c.jsx(KPICard,{title:"Total Sales",value:`₱${l.data.total_sales?.value?.toLocaleString()||"0"}`,change:l.data.total_sales?.change_percent,trend:l.data.total_sales?.trend,icon:c.jsx(K.Z,{className:"w-5 h-5"}),color:"text-green-600"}),c.jsx(KPICard,{title:"Transactions",value:l.data.transaction_count?.value?.toLocaleString()||"0",change:l.data.transaction_count?.change_percent,trend:l.data.transaction_count?.trend,icon:c.jsx(B.Z,{className:"w-5 h-5"}),color:"text-blue-600"}),c.jsx(KPICard,{title:"Unique Customers",value:l.data.unique_customers?.value?.toLocaleString()||"0",change:l.data.unique_customers?.change_percent,trend:l.data.unique_customers?.trend,icon:c.jsx($.Z,{className:"w-5 h-5"}),color:"text-purple-600"}),c.jsx(KPICard,{title:"Avg. Basket",value:`₱${Math.round(l.data.average_basket_size?.value||0)}`,change:l.data.average_basket_size?.change_percent,trend:l.data.average_basket_size?.trend,icon:c.jsx(B.Z,{className:"w-5 h-5"}),color:"text-orange-600"})]}),c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:c.jsx("div",{className:"flex space-x-4",children:[{key:"overview",label:"Overview"},{key:"brands",label:"Brand Performance"},{key:"stores",label:"Store Analysis"},{key:"customers",label:"Customer Insights"}].map(e=>c.jsx("button",{onClick:()=>a(e.key),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t===e.key?"bg-scout-primary text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:e.label},e.key))})}),o&&(0,c.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:["overview"===t&&(0,c.jsxs)(c.Fragment,{children:[c.jsx(ChartCard,{title:"Sales Trend",subtitle:"Daily sales over time",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(j.w,{data:o.timeSeries,children:[c.jsx(y.q,{strokeDasharray:"3 3"}),c.jsx(b.K,{dataKey:"date"}),c.jsx(v.B,{}),c.jsx(f.u,{formatter:(e,s)=>["sales"===s?`₱${Number(e).toLocaleString()}`:e,"sales"===s?"Sales":"transactions"===s?"Transactions":"Customers"]}),c.jsx(_.D,{}),c.jsx(N.x,{type:"monotone",dataKey:"sales",stroke:"#0066CC",strokeWidth:2,name:"Sales (₱)"})]})})}),c.jsx(ChartCard,{title:"Time of Day Performance",subtitle:"Sales by time segment",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(w.v,{data:o.timeOfDay,children:[c.jsx(y.q,{strokeDasharray:"3 3"}),c.jsx(b.K,{dataKey:"time_of_day"}),c.jsx(v.B,{}),c.jsx(f.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),c.jsx(S.$,{dataKey:"sales",fill:"#FF6B35"})]})})})]}),"brands"===t&&(0,c.jsxs)(c.Fragment,{children:[c.jsx(ChartCard,{title:"Top Performing Brands",subtitle:"Sales by brand",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(w.v,{data:o.brands,children:[c.jsx(y.q,{strokeDasharray:"3 3"}),c.jsx(b.K,{dataKey:"brand",angle:-45,textAnchor:"end",height:80}),c.jsx(v.B,{}),c.jsx(f.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),c.jsx(S.$,{dataKey:"sales",fill:"#4ECDC4"})]})})}),c.jsx(ChartCard,{title:"Brand Share",subtitle:"Market share by sales",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(q.u,{children:[c.jsx(C.b,{data:o.brands.slice(0,8),cx:"50%",cy:"50%",outerRadius:80,dataKey:"sales",nameKey:"brand",children:o.brands.slice(0,8).map((e,s)=>c.jsx(k.b,{fill:h[s%h.length]},`cell-${s}`))}),c.jsx(f.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),c.jsx(_.D,{})]})})})]}),"stores"===t&&(0,c.jsxs)(c.Fragment,{children:[c.jsx(ChartCard,{title:"Store Performance",subtitle:"Sales by store location",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(w.v,{data:o.stores,children:[c.jsx(y.q,{strokeDasharray:"3 3"}),c.jsx(b.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),c.jsx(v.B,{}),c.jsx(f.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),c.jsx(S.$,{dataKey:"sales",fill:"#45B7D1"})]})})}),c.jsx(ChartCard,{title:"Customer Count by Store",subtitle:"Unique customers per store",children:c.jsx(p.h,{width:"100%",height:300,children:(0,c.jsxs)(w.v,{data:o.stores,children:[c.jsx(y.q,{strokeDasharray:"3 3"}),c.jsx(b.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),c.jsx(v.B,{}),c.jsx(f.u,{}),c.jsx(S.$,{dataKey:"customers",fill:"#96CEB4"})]})})})]})]}),c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,c.jsxs)("span",{className:"text-sm text-gray-600",children:["Data Quality: ",r?.performance?.row_count||0," records processed"]})]}),(0,c.jsxs)("div",{className:"text-sm text-gray-500",children:["Query time: ",r?.performance?.query_time_ms||0,"ms",r?.cache?.hit&&" (cached)"]})]})})]})},KPICard=({title:e,value:s,change:t,trend:a,icon:r,color:i})=>c.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-gray-600",children:e}),c.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s}),null!=t&&c.jsx("div",{className:`flex items-center mt-1 text-sm ${t>0?"text-green-600":t<0?"text-red-600":"text-gray-600"}`,children:(0,c.jsxs)("span",{children:[t>0?"+":"",t,"%"]})})]}),c.jsx("div",{className:`${i}`,children:r})]})}),ChartCard=({title:e,subtitle:s,children:t})=>(0,c.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,c.jsxs)("div",{className:"mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e}),s&&c.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s})]}),t]});var A=t(7609);let pages=()=>(0,c.jsxs)(A.Z,{requiredPermissions:["scout_read"],children:[(0,c.jsxs)(u(),{children:[c.jsx("title",{children:"Scout v7 Analytics Dashboard"}),c.jsx("meta",{name:"description",content:"Real-time analytics and insights for Scout v7 platform"}),c.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),c.jsx("link",{rel:"icon",href:"/favicon.ico"})]}),(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,c.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,c.jsxs)("div",{className:"flex items-center",children:[c.jsx("div",{className:"flex-shrink-0",children:c.jsx("h1",{className:"text-xl font-bold text-scout-primary",children:"Scout v7"})}),(0,c.jsxs)("nav",{className:"hidden md:ml-8 md:flex md:space-x-8",children:[c.jsx("a",{href:"/",className:"text-gray-900 hover:text-scout-primary px-3 py-2 rounded-md text-sm font-medium",children:"Overview"}),c.jsx("a",{href:"/brands",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Brand Analytics"}),c.jsx("a",{href:"/stores",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Store Performance"}),c.jsx("a",{href:"/insights",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"AI Insights"})]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),c.jsx("span",{className:"text-xs text-gray-600",children:"Live"})]})]})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:c.jsx(TransactionDashboard,{})}),c.jsx("footer",{className:"bg-white border-t border-gray-200 mt-16",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,c.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-4",children:[c.jsx("div",{className:"text-sm text-gray-500",children:"\xa9 2025 TBWA Data Intelligence Team"}),c.jsx("div",{className:"text-sm text-gray-400",children:"|"}),c.jsx("div",{className:"text-sm text-gray-500",children:"Scout v7 Analytics Platform"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-6 mt-4 md:mt-0",children:[c.jsx("a",{href:"/api/scout/transactions",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"API Documentation"}),c.jsx("a",{href:"https://github.com/tbwa/scout-v7",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"GitHub"}),c.jsx("div",{className:"text-sm text-gray-400",children:"v1.0.0"})]})]})})})]})]}),F=(0,n.l)(a,"default"),I=(0,n.l)(a,"getStaticProps"),L=(0,n.l)(a,"getStaticPaths"),T=(0,n.l)(a,"getServerSideProps"),E=(0,n.l)(a,"config"),O=(0,n.l)(a,"reportWebVitals"),U=(0,n.l)(a,"unstable_getStaticProps"),Z=(0,n.l)(a,"unstable_getStaticPaths"),z=(0,n.l)(a,"unstable_getStaticParams"),M=(0,n.l)(a,"unstable_getServerProps"),R=(0,n.l)(a,"unstable_getServerSideProps"),Q=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:a})},8910:e=>{e.exports=require("@tanstack/react-query")},8103:e=>{e.exports=require("clsx")},5502:e=>{e.exports=require("eventemitter3")},8759:e=>{e.exports=require("lodash/every")},6918:e=>{e.exports=require("lodash/find")},8190:e=>{e.exports=require("lodash/flatMap")},1712:e=>{e.exports=require("lodash/get")},2327:e=>{e.exports=require("lodash/isBoolean")},113:e=>{e.exports=require("lodash/isEqual")},5716:e=>{e.exports=require("lodash/isFunction")},8843:e=>{e.exports=require("lodash/isNaN")},6069:e=>{e.exports=require("lodash/isNil")},7078:e=>{e.exports=require("lodash/isNumber")},5795:e=>{e.exports=require("lodash/isObject")},5452:e=>{e.exports=require("lodash/isPlainObject")},7026:e=>{e.exports=require("lodash/isString")},3824:e=>{e.exports=require("lodash/last")},9941:e=>{e.exports=require("lodash/mapValues")},6625:e=>{e.exports=require("lodash/max")},1341:e=>{e.exports=require("lodash/maxBy")},541:e=>{e.exports=require("lodash/memoize")},604:e=>{e.exports=require("lodash/min")},9318:e=>{e.exports=require("lodash/minBy")},4042:e=>{e.exports=require("lodash/range")},4129:e=>{e.exports=require("lodash/some")},3672:e=>{e.exports=require("lodash/sortBy")},1381:e=>{e.exports=require("lodash/throttle")},9309:e=>{e.exports=require("lodash/uniqBy")},5428:e=>{e.exports=require("lodash/upperFirst")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},1423:e=>{e.exports=require("path")},6689:e=>{e.exports=require("react")},1469:e=>{e.exports=require("react-is")},3522:e=>{e.exports=require("react-smooth")},997:e=>{e.exports=require("react/jsx-runtime")},9540:e=>{e.exports=require("recharts-scale")},8780:e=>{e.exports=require("tiny-invariant")},8970:e=>{e.exports=require("victory-vendor/d3-scale")},2725:e=>{e.exports=require("victory-vendor/d3-shape")}};var s=require("../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[938,259,414,959,25,609],()=>__webpack_exec__(2056));module.exports=t})();