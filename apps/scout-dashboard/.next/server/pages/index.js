"use strict";(()=>{var e={};e.id=405,e.ids=[405,888,660],e.modules={3523:(e,s,t)=>{t.a(e,async(e,a)=>{try{t.r(s),t.d(s,{config:()=>g,default:()=>m,getServerSideProps:()=>p,getStaticPaths:()=>u,getStaticProps:()=>h,reportWebVitals:()=>j,routeModule:()=>N,unstable_getServerProps:()=>f,unstable_getServerSideProps:()=>_,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>b,unstable_getStaticProps:()=>y});var r=t(8877),i=t(4591),n=t(6021),l=t(1938),d=t.n(l),o=t(5479),c=t(1971),x=e([o,c]);[o,c]=x.then?(await x)():x;let m=(0,n.l)(c,"default"),h=(0,n.l)(c,"getStaticProps"),u=(0,n.l)(c,"getStaticPaths"),p=(0,n.l)(c,"getServerSideProps"),g=(0,n.l)(c,"config"),j=(0,n.l)(c,"reportWebVitals"),y=(0,n.l)(c,"unstable_getStaticProps"),b=(0,n.l)(c,"unstable_getStaticPaths"),v=(0,n.l)(c,"unstable_getStaticParams"),f=(0,n.l)(c,"unstable_getServerProps"),_=(0,n.l)(c,"unstable_getServerSideProps"),N=new r.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/index",pathname:"/",bundlePath:"",filename:""},components:{App:o.default,Document:d()},userland:c});a()}catch(e){a(e)}})},263:(e,s,t)=>{t.a(e,async(e,a)=>{try{t.d(s,{S:()=>TransactionDashboard});var r=t(997),i=t(6689),n=t.n(i),l=t(9752),d=t(8205),o=t(2908),c=t(5484),x=t(5556),m=t(3131),h=t(4377),u=t(6629),p=t(3004),g=t(739),j=t(4908),y=t(3454),b=t(7513),v=t(1011),f=t(6026),_=t(790),N=t(8635),w=t(5490),S=t(4288),q=e([l,d,o,c,x,m,h,u,p,g,j,y,b]);[l,d,o,c,x,m,h,u,p,g,j,y,b]=q.then?(await q)():q;let TransactionDashboard=()=>{let[e,s]=(0,i.useState)({date_range:{start:new Date(Date.now()-2592e6).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},store_ids:["102","103","104","109","110","112"]}),[t,a]=(0,i.useState)("overview"),{data:q,isLoading:C,error:P}=(0,l.useQuery)({queryKey:["scout-transactions",e],queryFn:async()=>{let s=new URLSearchParams;e.store_ids?.length&&s.append("store_ids",e.store_ids.join(",")),e.brands?.length&&s.append("brands",e.brands.join(",")),e.categories?.length&&s.append("categories",e.categories.join(",")),e.date_range&&(s.append("date_start",e.date_range.start),s.append("date_end",e.date_range.end)),s.append("limit","5000");let t=await fetch(`/api/scout/transactions?${s}`,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Failed to fetch transactions");return t.json()},refetchInterval:3e5,staleTime:24e4}),{data:k,isLoading:D}=(0,l.useQuery)({queryKey:["scout-kpis",e],queryFn:async()=>{let s=new URLSearchParams;e.store_ids?.length&&s.append("store_ids",e.store_ids.join(",")),e.categories?.length&&s.append("categories",e.categories.join(",")),e.date_range&&(s.append("date_start",e.date_range.start),s.append("date_end",e.date_range.end));let t=await fetch(`/api/transactions/kpis?${s}`,{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!t.ok)throw Error("Failed to fetch KPIs");return t.json()},refetchInterval:3e5}),K=n().useMemo(()=>{if(!q?.data)return null;let e=q.data,s=e.reduce((e,s)=>{let t=s.date_ph;return e[t]||(e[t]={date:t,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),t=Object.values(s).map(e=>({...e,customers:e.customers.size})).sort((e,s)=>e.date.localeCompare(s.date)),a=e.reduce((e,s)=>{let t=s.brand||"Unknown";return e[t]||(e[t]={brand:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),r=Object.values(a).sort((e,s)=>s.sales-e.sales).slice(0,10),i=e.reduce((e,s)=>{let t=s.store_id||"Unknown",a=s.store_name||`Store ${t}`;return e[t]||(e[t]={store_id:t,store_name:a,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),n=Object.values(i).map(e=>({...e,customers:e.customers.size,avg_transaction:e.sales/e.transactions})).sort((e,s)=>s.sales-e.sales),l=e.reduce((e,s)=>{let t=s.time_of_day||"Unknown";return e[t]||(e[t]={time_of_day:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),d=Object.values(l);return{timeSeries:t,brands:r,stores:n,timeOfDay:d}},[q]),B=["#0066CC","#FF6B35","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#2C3E50"];return C||D?r.jsx("div",{className:"flex items-center justify-center h-96",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-scout-primary"})}):P?(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[r.jsx("h3",{className:"text-red-800 font-medium",children:"Error Loading Data"}),r.jsx("p",{className:"text-red-600 text-sm mt-1",children:P instanceof Error?P.message:"Unknown error occurred"})]}):(0,r.jsxs)("div",{className:"space-y-6","data-testid":"transaction-dashboard",children:[r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Scout v7 Analytics"}),r.jsx("p",{className:"text-gray-600 mt-1",children:"Real-time transaction analytics and customer insights"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[r.jsx(f.Z,{className:"w-4 h-4 mr-1"}),e.date_range?.start," to ",e.date_range?.end]}),(0,r.jsxs)("button",{className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:[r.jsx(_.Z,{className:"w-4 h-4 mr-1"}),"Filters"]})]})]})}),k?.data&&(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r.jsx(KPICard,{title:"Total Sales",value:`₱${k.data.total_sales?.value?.toLocaleString()||"0"}`,change:k.data.total_sales?.change_percent,trend:k.data.total_sales?.trend,icon:r.jsx(N.Z,{className:"w-5 h-5"}),color:"text-green-600"}),r.jsx(KPICard,{title:"Transactions",value:k.data.transaction_count?.value?.toLocaleString()||"0",change:k.data.transaction_count?.change_percent,trend:k.data.transaction_count?.trend,icon:r.jsx(w.Z,{className:"w-5 h-5"}),color:"text-blue-600"}),r.jsx(KPICard,{title:"Unique Customers",value:k.data.unique_customers?.value?.toLocaleString()||"0",change:k.data.unique_customers?.change_percent,trend:k.data.unique_customers?.trend,icon:r.jsx(S.Z,{className:"w-5 h-5"}),color:"text-purple-600"}),r.jsx(KPICard,{title:"Avg. Basket",value:`₱${Math.round(k.data.average_basket_size?.value||0)}`,change:k.data.average_basket_size?.change_percent,trend:k.data.average_basket_size?.trend,icon:r.jsx(w.Z,{className:"w-5 h-5"}),color:"text-orange-600"})]}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:r.jsx("div",{className:"flex space-x-4",children:[{key:"overview",label:"Overview"},{key:"brands",label:"Brand Performance"},{key:"stores",label:"Store Analysis"},{key:"customers",label:"Customer Insights"}].map(e=>r.jsx("button",{onClick:()=>a(e.key),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t===e.key?"bg-scout-primary text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:e.label},e.key))})}),K&&(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:["overview"===t&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(ChartCard,{title:"Sales Trend",subtitle:"Daily sales over time",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(o.w,{data:K.timeSeries,children:[r.jsx(c.q,{strokeDasharray:"3 3"}),r.jsx(x.K,{dataKey:"date"}),r.jsx(m.B,{}),r.jsx(h.u,{formatter:(e,s)=>["sales"===s?`₱${Number(e).toLocaleString()}`:e,"sales"===s?"Sales":"transactions"===s?"Transactions":"Customers"]}),r.jsx(u.D,{}),r.jsx(p.x,{type:"monotone",dataKey:"sales",stroke:"#0066CC",strokeWidth:2,name:"Sales (₱)"})]})})}),r.jsx(ChartCard,{title:"Time of Day Performance",subtitle:"Sales by time segment",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(g.v,{data:K.timeOfDay,children:[r.jsx(c.q,{strokeDasharray:"3 3"}),r.jsx(x.K,{dataKey:"time_of_day"}),r.jsx(m.B,{}),r.jsx(h.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),r.jsx(j.$,{dataKey:"sales",fill:"#FF6B35"})]})})})]}),"brands"===t&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(ChartCard,{title:"Top Performing Brands",subtitle:"Sales by brand",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(g.v,{data:K.brands,children:[r.jsx(c.q,{strokeDasharray:"3 3"}),r.jsx(x.K,{dataKey:"brand",angle:-45,textAnchor:"end",height:80}),r.jsx(m.B,{}),r.jsx(h.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),r.jsx(j.$,{dataKey:"sales",fill:"#4ECDC4"})]})})}),r.jsx(ChartCard,{title:"Brand Share",subtitle:"Market share by sales",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(y.u,{children:[r.jsx(b.b,{data:K.brands.slice(0,8),cx:"50%",cy:"50%",outerRadius:80,dataKey:"sales",nameKey:"brand",children:K.brands.slice(0,8).map((e,s)=>r.jsx(v.b,{fill:B[s%B.length]},`cell-${s}`))}),r.jsx(h.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),r.jsx(u.D,{})]})})})]}),"stores"===t&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(ChartCard,{title:"Store Performance",subtitle:"Sales by store location",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(g.v,{data:K.stores,children:[r.jsx(c.q,{strokeDasharray:"3 3"}),r.jsx(x.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),r.jsx(m.B,{}),r.jsx(h.u,{formatter:e=>[`₱${Number(e).toLocaleString()}`,"Sales"]}),r.jsx(j.$,{dataKey:"sales",fill:"#45B7D1"})]})})}),r.jsx(ChartCard,{title:"Customer Count by Store",subtitle:"Unique customers per store",children:r.jsx(d.h,{width:"100%",height:300,children:(0,r.jsxs)(g.v,{data:K.stores,children:[r.jsx(c.q,{strokeDasharray:"3 3"}),r.jsx(x.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),r.jsx(m.B,{}),r.jsx(h.u,{}),r.jsx(j.$,{dataKey:"customers",fill:"#96CEB4"})]})})})]})]}),r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Data Quality: ",q?.performance?.row_count||0," records processed"]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:["Query time: ",q?.performance?.query_time_ms||0,"ms",q?.cache?.hit&&" (cached)"]})]})})]})},KPICard=({title:e,value:s,change:t,trend:a,icon:i,color:n})=>r.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:e}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:s}),null!=t&&r.jsx("div",{className:`flex items-center mt-1 text-sm ${t>0?"text-green-600":t<0?"text-red-600":"text-gray-600"}`,children:(0,r.jsxs)("span",{children:[t>0?"+":"",t,"%"]})})]}),r.jsx("div",{className:`${n}`,children:i})]})}),ChartCard=({title:e,subtitle:s,children:t})=>(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,r.jsxs)("div",{className:"mb-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:e}),s&&r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s})]}),t]});a()}catch(e){a(e)}})},1971:(e,s,t)=>{t.a(e,async(e,a)=>{try{t.r(s),t.d(s,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var r=t(997);t(6689);var i=t(968),n=t.n(i),l=t(263),d=t(7609),o=e([l]);l=(o.then?(await o)():o)[0];let __WEBPACK_DEFAULT_EXPORT__=()=>(0,r.jsxs)(d.Z,{requiredPermissions:["scout_read"],children:[(0,r.jsxs)(n(),{children:[r.jsx("title",{children:"Scout v7 Analytics Dashboard"}),r.jsx("meta",{name:"description",content:"Real-time analytics and insights for Scout v7 platform"}),r.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),r.jsx("link",{rel:"icon",href:"/favicon.ico"})]}),(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx("h1",{className:"text-xl font-bold text-scout-primary",children:"Scout v7"})}),(0,r.jsxs)("nav",{className:"hidden md:ml-8 md:flex md:space-x-8",children:[r.jsx("a",{href:"/",className:"text-gray-900 hover:text-scout-primary px-3 py-2 rounded-md text-sm font-medium",children:"Overview"}),r.jsx("a",{href:"/brands",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Brand Analytics"}),r.jsx("a",{href:"/stores",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Store Performance"}),r.jsx("a",{href:"/insights",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"AI Insights"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),r.jsx("span",{className:"text-xs text-gray-600",children:"Live"})]})]})]})})}),r.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r.jsx(l.S,{})}),r.jsx("footer",{className:"bg-white border-t border-gray-200 mt-16",children:r.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,r.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("div",{className:"text-sm text-gray-500",children:"\xa9 2025 TBWA Data Intelligence Team"}),r.jsx("div",{className:"text-sm text-gray-400",children:"|"}),r.jsx("div",{className:"text-sm text-gray-500",children:"Scout v7 Analytics Platform"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-6 mt-4 md:mt-0",children:[r.jsx("a",{href:"/api/scout/transactions",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"API Documentation"}),r.jsx("a",{href:"https://github.com/tbwa/scout-v7",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"GitHub"}),r.jsx("div",{className:"text-sm text-gray-400",children:"v1.0.0"})]})]})})})]})]});a()}catch(e){a(e)}})},5502:e=>{e.exports=require("eventemitter3")},8759:e=>{e.exports=require("lodash/every")},6918:e=>{e.exports=require("lodash/find")},8190:e=>{e.exports=require("lodash/flatMap")},1712:e=>{e.exports=require("lodash/get")},2327:e=>{e.exports=require("lodash/isBoolean")},113:e=>{e.exports=require("lodash/isEqual")},5716:e=>{e.exports=require("lodash/isFunction")},8843:e=>{e.exports=require("lodash/isNaN")},6069:e=>{e.exports=require("lodash/isNil")},7078:e=>{e.exports=require("lodash/isNumber")},5795:e=>{e.exports=require("lodash/isObject")},5452:e=>{e.exports=require("lodash/isPlainObject")},7026:e=>{e.exports=require("lodash/isString")},3824:e=>{e.exports=require("lodash/last")},9941:e=>{e.exports=require("lodash/mapValues")},6625:e=>{e.exports=require("lodash/max")},1341:e=>{e.exports=require("lodash/maxBy")},541:e=>{e.exports=require("lodash/memoize")},604:e=>{e.exports=require("lodash/min")},9318:e=>{e.exports=require("lodash/minBy")},4042:e=>{e.exports=require("lodash/range")},4129:e=>{e.exports=require("lodash/some")},3672:e=>{e.exports=require("lodash/sortBy")},1381:e=>{e.exports=require("lodash/throttle")},9309:e=>{e.exports=require("lodash/uniqBy")},5428:e=>{e.exports=require("lodash/upperFirst")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},1423:e=>{e.exports=require("path")},6689:e=>{e.exports=require("react")},1469:e=>{e.exports=require("react-is")},3522:e=>{e.exports=require("react-smooth")},997:e=>{e.exports=require("react/jsx-runtime")},9540:e=>{e.exports=require("recharts-scale")},8970:e=>{e.exports=require("victory-vendor/d3-scale")},2725:e=>{e.exports=require("victory-vendor/d3-shape")},9752:e=>{e.exports=import("@tanstack/react-query")},6593:e=>{e.exports=import("clsx")},4281:e=>{e.exports=import("tiny-invariant")}};var s=require("../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[938,259,414,959,479,609],()=>__webpack_exec__(3523));module.exports=t})();