(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{7314:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return t(3689)}])},7609:function(e,s,t){"use strict";var a=t(5893);t(7294),s.Z=e=>{let{children:s}=e;return(0,a.jsx)("div",{className:"scout-auth-context",children:s})}},3689:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return pages}});var a=t(5893),r=t(7294),n=t(7729),i=t.n(n),l=t(5300),d=t(8205),o=t(2908),c=t(5484),x=t(5556),m=t(3131),h=t(1154),u=t(5734),v=t(3004),g=t(739),j=t(171),y=t(3454),p=t(9941),b=t(1011),f=t(6026),N=t(790),_=t(8635),w=t(5490),C=t(4288);let TransactionDashboard=()=>{var e,s,t,n,i,S,k,D,K,P,B,q,A,E,I,L,T,F,O,U;let[Z,z]=(0,r.useState)({date_range:{start:new Date(Date.now()-2592e6).toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]},store_ids:["102","103","104","109","110","112"]}),[R,$]=(0,r.useState)("overview"),{data:M,isLoading:H,error:Q}=(0,l.a)({queryKey:["scout-transactions",Z],queryFn:async()=>{var e,s,t;let a=new URLSearchParams;(null===(e=Z.store_ids)||void 0===e?void 0:e.length)&&a.append("store_ids",Z.store_ids.join(",")),(null===(s=Z.brands)||void 0===s?void 0:s.length)&&a.append("brands",Z.brands.join(",")),(null===(t=Z.categories)||void 0===t?void 0:t.length)&&a.append("categories",Z.categories.join(",")),Z.date_range&&(a.append("date_start",Z.date_range.start),a.append("date_end",Z.date_range.end)),a.append("limit","5000");let r=await fetch("/api/scout/transactions?".concat(a),{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!r.ok)throw Error("Failed to fetch transactions");return r.json()},refetchInterval:3e5,staleTime:24e4}),{data:W,isLoading:X}=(0,l.a)({queryKey:["scout-kpis",Z],queryFn:async()=>{var e,s;let t=new URLSearchParams;(null===(e=Z.store_ids)||void 0===e?void 0:e.length)&&t.append("store_ids",Z.store_ids.join(",")),(null===(s=Z.categories)||void 0===s?void 0:s.length)&&t.append("categories",Z.categories.join(",")),Z.date_range&&(t.append("date_start",Z.date_range.start),t.append("date_end",Z.date_range.end));let a=await fetch("/api/transactions/kpis?".concat(t),{cache:"no-store",headers:{"Cache-Control":"no-cache"}});if(!a.ok)throw Error("Failed to fetch KPIs");return a.json()},refetchInterval:3e5}),G=r.useMemo(()=>{if(!(null==M?void 0:M.data))return null;let e=M.data,s=e.reduce((e,s)=>{let t=s.date_ph;return e[t]||(e[t]={date:t,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),t=Object.values(s).map(e=>({...e,customers:e.customers.size})).sort((e,s)=>e.date.localeCompare(s.date)),a=e.reduce((e,s)=>{let t=s.brand||"Unknown";return e[t]||(e[t]={brand:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),r=Object.values(a).sort((e,s)=>s.sales-e.sales).slice(0,10),n=e.reduce((e,s)=>{let t=s.store_id||"Unknown",a=s.store_name||"Store ".concat(t);return e[t]||(e[t]={store_id:t,store_name:a,sales:0,transactions:0,customers:new Set}),e[t].sales+=s.total_price||0,e[t].transactions++,s.facial_id&&e[t].customers.add(s.facial_id),e},{}),i=Object.values(n).map(e=>({...e,customers:e.customers.size,avg_transaction:e.sales/e.transactions})).sort((e,s)=>s.sales-e.sales),l=e.reduce((e,s)=>{let t=s.time_of_day||"Unknown";return e[t]||(e[t]={time_of_day:t,sales:0,transactions:0}),e[t].sales+=s.total_price||0,e[t].transactions++,e},{}),d=Object.values(l);return{timeSeries:t,brands:r,stores:i,timeOfDay:d}},[M]),J=["#0066CC","#FF6B35","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#2C3E50"];return H||X?(0,a.jsx)("div",{className:"flex items-center justify-center h-96",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-scout-primary"})}):Q?(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-red-800 font-medium",children:"Error Loading Data"}),(0,a.jsx)("p",{className:"text-red-600 text-sm mt-1",children:Q instanceof Error?Q.message:"Unknown error occurred"})]}):(0,a.jsxs)("div",{className:"space-y-6","data-testid":"transaction-dashboard",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Scout v7 Analytics"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Real-time transaction analytics and customer insights"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-4 sm:mt-0",children:[(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,a.jsx)(f.Z,{className:"w-4 h-4 mr-1"}),null===(e=Z.date_range)||void 0===e?void 0:e.start," to ",null===(s=Z.date_range)||void 0===s?void 0:s.end]}),(0,a.jsxs)("button",{className:"flex items-center px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-1"}),"Filters"]})]})]})}),(null==W?void 0:W.data)&&(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,a.jsx)(KPICard,{title:"Total Sales",value:"₱".concat((null===(n=W.data.total_sales)||void 0===n?void 0:null===(t=n.value)||void 0===t?void 0:t.toLocaleString())||"0"),change:null===(i=W.data.total_sales)||void 0===i?void 0:i.change_percent,trend:null===(S=W.data.total_sales)||void 0===S?void 0:S.trend,icon:(0,a.jsx)(_.Z,{className:"w-5 h-5"}),color:"text-green-600"}),(0,a.jsx)(KPICard,{title:"Transactions",value:(null===(D=W.data.transaction_count)||void 0===D?void 0:null===(k=D.value)||void 0===k?void 0:k.toLocaleString())||"0",change:null===(K=W.data.transaction_count)||void 0===K?void 0:K.change_percent,trend:null===(P=W.data.transaction_count)||void 0===P?void 0:P.trend,icon:(0,a.jsx)(w.Z,{className:"w-5 h-5"}),color:"text-blue-600"}),(0,a.jsx)(KPICard,{title:"Unique Customers",value:(null===(q=W.data.unique_customers)||void 0===q?void 0:null===(B=q.value)||void 0===B?void 0:B.toLocaleString())||"0",change:null===(A=W.data.unique_customers)||void 0===A?void 0:A.change_percent,trend:null===(E=W.data.unique_customers)||void 0===E?void 0:E.trend,icon:(0,a.jsx)(C.Z,{className:"w-5 h-5"}),color:"text-purple-600"}),(0,a.jsx)(KPICard,{title:"Avg. Basket",value:"₱".concat(Math.round((null===(I=W.data.average_basket_size)||void 0===I?void 0:I.value)||0)),change:null===(L=W.data.average_basket_size)||void 0===L?void 0:L.change_percent,trend:null===(T=W.data.average_basket_size)||void 0===T?void 0:T.trend,icon:(0,a.jsx)(w.Z,{className:"w-5 h-5"}),color:"text-orange-600"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,a.jsx)("div",{className:"flex space-x-4",children:[{key:"overview",label:"Overview"},{key:"brands",label:"Brand Performance"},{key:"stores",label:"Store Analysis"},{key:"customers",label:"Customer Insights"}].map(e=>(0,a.jsx)("button",{onClick:()=>$(e.key),className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(R===e.key?"bg-scout-primary text-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:e.label},e.key))})}),G&&(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:["overview"===R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ChartCard,{title:"Sales Trend",subtitle:"Daily sales over time",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(o.w,{data:G.timeSeries,children:[(0,a.jsx)(c.q,{strokeDasharray:"3 3"}),(0,a.jsx)(x.K,{dataKey:"date"}),(0,a.jsx)(m.B,{}),(0,a.jsx)(h.u,{formatter:(e,s)=>["sales"===s?"₱".concat(Number(e).toLocaleString()):e,"sales"===s?"Sales":"transactions"===s?"Transactions":"Customers"]}),(0,a.jsx)(u.D,{}),(0,a.jsx)(v.x,{type:"monotone",dataKey:"sales",stroke:"#0066CC",strokeWidth:2,name:"Sales (₱)"})]})})}),(0,a.jsx)(ChartCard,{title:"Time of Day Performance",subtitle:"Sales by time segment",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(g.v,{data:G.timeOfDay,children:[(0,a.jsx)(c.q,{strokeDasharray:"3 3"}),(0,a.jsx)(x.K,{dataKey:"time_of_day"}),(0,a.jsx)(m.B,{}),(0,a.jsx)(h.u,{formatter:e=>["₱".concat(Number(e).toLocaleString()),"Sales"]}),(0,a.jsx)(j.$,{dataKey:"sales",fill:"#FF6B35"})]})})})]}),"brands"===R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ChartCard,{title:"Top Performing Brands",subtitle:"Sales by brand",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(g.v,{data:G.brands,children:[(0,a.jsx)(c.q,{strokeDasharray:"3 3"}),(0,a.jsx)(x.K,{dataKey:"brand",angle:-45,textAnchor:"end",height:80}),(0,a.jsx)(m.B,{}),(0,a.jsx)(h.u,{formatter:e=>["₱".concat(Number(e).toLocaleString()),"Sales"]}),(0,a.jsx)(j.$,{dataKey:"sales",fill:"#4ECDC4"})]})})}),(0,a.jsx)(ChartCard,{title:"Brand Share",subtitle:"Market share by sales",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(y.u,{children:[(0,a.jsx)(p.b,{data:G.brands.slice(0,8),cx:"50%",cy:"50%",outerRadius:80,dataKey:"sales",nameKey:"brand",children:G.brands.slice(0,8).map((e,s)=>(0,a.jsx)(b.b,{fill:J[s%J.length]},"cell-".concat(s)))}),(0,a.jsx)(h.u,{formatter:e=>["₱".concat(Number(e).toLocaleString()),"Sales"]}),(0,a.jsx)(u.D,{})]})})})]}),"stores"===R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ChartCard,{title:"Store Performance",subtitle:"Sales by store location",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(g.v,{data:G.stores,children:[(0,a.jsx)(c.q,{strokeDasharray:"3 3"}),(0,a.jsx)(x.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),(0,a.jsx)(m.B,{}),(0,a.jsx)(h.u,{formatter:e=>["₱".concat(Number(e).toLocaleString()),"Sales"]}),(0,a.jsx)(j.$,{dataKey:"sales",fill:"#45B7D1"})]})})}),(0,a.jsx)(ChartCard,{title:"Customer Count by Store",subtitle:"Unique customers per store",children:(0,a.jsx)(d.h,{width:"100%",height:300,children:(0,a.jsxs)(g.v,{data:G.stores,children:[(0,a.jsx)(c.q,{strokeDasharray:"3 3"}),(0,a.jsx)(x.K,{dataKey:"store_name",angle:-45,textAnchor:"end",height:80}),(0,a.jsx)(m.B,{}),(0,a.jsx)(h.u,{}),(0,a.jsx)(j.$,{dataKey:"customers",fill:"#96CEB4"})]})})})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Data Quality: ",(null==M?void 0:null===(F=M.performance)||void 0===F?void 0:F.row_count)||0," records processed"]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:["Query time: ",(null==M?void 0:null===(O=M.performance)||void 0===O?void 0:O.query_time_ms)||0,"ms",(null==M?void 0:null===(U=M.cache)||void 0===U?void 0:U.hit)&&" (cached)"]})]})})]})},KPICard=e=>{let{title:s,value:t,change:r,trend:n,icon:i,color:l}=e;return(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:s}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:t}),null!=r&&(0,a.jsx)("div",{className:"flex items-center mt-1 text-sm ".concat(r>0?"text-green-600":r<0?"text-red-600":"text-gray-600"),children:(0,a.jsxs)("span",{children:[r>0?"+":"",r,"%"]})})]}),(0,a.jsx)("div",{className:"".concat(l),children:i})]})})},ChartCard=e=>{let{title:s,subtitle:t,children:r}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:s}),t&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:t})]}),r]})};var S=t(7609),pages=()=>(0,a.jsxs)(S.Z,{requiredPermissions:["scout_read"],children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Scout v7 Analytics Dashboard"}),(0,a.jsx)("meta",{name:"description",content:"Real-time analytics and insights for Scout v7 platform"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center h-16",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-scout-primary",children:"Scout v7"})}),(0,a.jsxs)("nav",{className:"hidden md:ml-8 md:flex md:space-x-8",children:[(0,a.jsx)("a",{href:"/",className:"text-gray-900 hover:text-scout-primary px-3 py-2 rounded-md text-sm font-medium",children:"Overview"}),(0,a.jsx)("a",{href:"/brands",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Brand Analytics"}),(0,a.jsx)("a",{href:"/stores",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"Store Performance"}),(0,a.jsx)("a",{href:"/insights",className:"text-gray-500 hover:text-gray-700 px-3 py-2 rounded-md text-sm font-medium",children:"AI Insights"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:new Date().toLocaleDateString("en-PH",{weekday:"short",year:"numeric",month:"short",day:"numeric"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,a.jsx)("span",{className:"text-xs text-gray-600",children:"Live"})]})]})]})})}),(0,a.jsx)("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsx)(TransactionDashboard,{})}),(0,a.jsx)("footer",{className:"bg-white border-t border-gray-200 mt-16",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"\xa9 2025 TBWA Data Intelligence Team"}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"|"}),(0,a.jsx)("div",{className:"text-sm text-gray-500",children:"Scout v7 Analytics Platform"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 mt-4 md:mt-0",children:[(0,a.jsx)("a",{href:"/api/scout/transactions",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"API Documentation"}),(0,a.jsx)("a",{href:"https://github.com/tbwa/scout-v7",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-500 hover:text-gray-700",children:"GitHub"}),(0,a.jsx)("div",{className:"text-sm text-gray-400",children:"v1.0.0"})]})]})})})]})]})}},function(e){e.O(0,[765,959,774,888,179],function(){return e(e.s=7314)}),_N_E=e.O()}]);