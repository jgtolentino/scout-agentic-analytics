import React, { useState, useEffect } from 'react';
import { useRouter } from 'next/router';\nimport { useFilterBus, useDrillBreadcrumbs } from '@/state/filterBus';\nimport EnhancedV7Renderer from './v7/EnhancedRenderer';\n\ninterface DashboardLayoutProps {\n  children?: React.ReactNode;\n}\n\nexport default function DashboardLayout({ children }: DashboardLayoutProps) {\n  const router = useRouter();\n  const { pageId } = router.query;\n  const [sidebarOpen, setSidebarOpen] = useState(false);\n  const [config, setConfig] = useState<any>(null);\n  \n  const { filters, reset: resetFilters } = useFilterBus();\n  const { breadcrumbs, removeDrill, clearDrills } = useDrillBreadcrumbs();\n\n  // Load dashboard configuration\n  useEffect(() => {\n    fetch('/config/scout-v7-complete.json')\n      .then(res => res.json())\n      .then(setConfig)\n      .catch(console.error);\n  }, []);\n\n  const pages = config?.pages || [];\n  const currentPage = pages.find((p: any) => p.id === pageId);\n\n  const navigation = [\n    {\n      name: 'Transaction Trends',\n      id: 'transaction_trends',\n      icon: 'ðŸ“ˆ',\n      description: 'Volume and patterns over time'\n    },\n    {\n      name: 'Product Mix & SKU',\n      id: 'product_mix',\n      icon: 'ðŸ“¦',\n      description: 'Category and brand analysis'\n    },\n    {\n      name: 'Consumer Behavior',\n      id: 'consumer_behavior',\n      icon: 'ðŸŽ¯',\n      description: 'Preferences and signals'\n    },\n    {\n      name: 'Consumer Profiling',\n      id: 'consumer_profiling',\n      icon: 'ðŸ‘¥',\n      description: 'Demographics and segmentation'\n    },\n    {\n      name: 'Executive Overview',\n      id: 'executive_overview',\n      icon: 'ðŸ“Š',\n      description: 'KPIs and comparative trends'\n    },\n    {\n      name: 'Competitive Analysis',\n      id: 'competitive_analysis',\n      icon: 'âš”ï¸',\n      description: 'Market share and rankings'\n    },\n    {\n      name: 'Geographic Intelligence',\n      id: 'geo_intel',\n      icon: 'ðŸ—ºï¸',\n      description: 'Regional performance maps'\n    },\n    {\n      name: 'AI Recommendations',\n      id: 'ai_recommendations',\n      icon: 'ðŸ¤–',\n      description: 'Intelligent insights and actions'\n    },\n    {\n      name: 'Figma Visualization',\n      id: 'figma_visualization_showcase',\n      icon: 'ðŸŽ¨',\n      description: 'Advanced chart gallery'\n    },\n    {\n      name: 'Financial Analysis',\n      id: 'stockbot_financial_analysis',\n      icon: 'ðŸ’°',\n      description: 'Market and trading insights'\n    }\n  ];\n\n  const handleNavigation = (pageId: string) => {\n    router.push(`/dash/${pageId}`);\n    setSidebarOpen(false);\n  };\n\n  const activeFilters = Object.entries(filters)\n    .filter(([key, value]) => value != null && value !== '' && !(Array.isArray(value) && value.length === 0))\n    .length;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Mobile sidebar backdrop */}\n      {sidebarOpen && (\n        <div\n          className=\"fixed inset-0 z-40 lg:hidden\"\n          onClick={() => setSidebarOpen(false)}\n        >\n          <div className=\"absolute inset-0 bg-gray-600 opacity-75\"></div>\n        </div>\n      )}\n\n      {/* Sidebar */}\n      <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg transform ${\n        sidebarOpen ? 'translate-x-0' : '-translate-x-full'\n      } transition-transform duration-300 ease-in-out lg:translate-x-0 lg:static lg:inset-0`}>\n        \n        {/* Sidebar Header */}\n        <div className=\"flex items-center justify-between h-16 px-4 bg-blue-600 text-white\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"text-2xl\">ðŸ”­</div>\n            <div>\n              <div className=\"font-bold\">Scout Dashboard</div>\n              <div className=\"text-xs opacity-75\">v7.0 Enhanced</div>\n            </div>\n          </div>\n          <button\n            onClick={() => setSidebarOpen(false)}\n            className=\"lg:hidden p-1 rounded hover:bg-blue-700\"\n          >\n            âœ•\n          </button>\n        </div>\n\n        {/* Active Filters Summary */}\n        {activeFilters > 0 && (\n          <div className=\"p-4 bg-blue-50 border-b\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-sm font-medium text-blue-800\">\n                Active Filters ({activeFilters})\n              </div>\n              <button\n                onClick={resetFilters}\n                className=\"text-xs text-blue-600 hover:text-blue-800 underline\"\n              >\n                Clear All\n              </button>\n            </div>\n            <div className=\"text-xs text-blue-600\">\n              {Object.entries(filters)\n                .filter(([, value]) => value != null && value !== '' && !(Array.isArray(value) && value.length === 0))\n                .map(([key, value]) => (\n                  <div key={key} className=\"truncate\">\n                    {key}: {Array.isArray(value) ? value.length + ' items' : String(value)}\n                  </div>\n                ))\n                .slice(0, 3)}\n              {activeFilters > 3 && <div>... and {activeFilters - 3} more</div>}\n            </div>\n          </div>\n        )}\n\n        {/* Drill-down Breadcrumbs */}\n        {breadcrumbs.length > 0 && (\n          <div className=\"p-4 bg-amber-50 border-b\">\n            <div className=\"flex items-center justify-between mb-2\">\n              <div className=\"text-sm font-medium text-amber-800\">\n                Drill Path ({breadcrumbs.length})\n              </div>\n              <button\n                onClick={clearDrills}\n                className=\"text-xs text-amber-600 hover:text-amber-800 underline\"\n              >\n                Clear Path\n              </button>\n            </div>\n            <div className=\"space-y-1\">\n              {breadcrumbs.map((crumb, index) => (\n                <div key={index} className=\"flex items-center text-xs\">\n                  <button\n                    onClick={() => removeDrill(index)}\n                    className=\"text-amber-600 hover:text-amber-800 underline mr-1\"\n                  >\n                    {crumb.label}\n                  </button>\n                  {index < breadcrumbs.length - 1 && <span className=\"text-amber-500 mx-1\">â†’</span>}\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n\n        {/* Navigation */}\n        <nav className=\"flex-1 px-4 py-4 space-y-1 overflow-y-auto\">\n          {navigation.map((item) => {\n            const isActive = pageId === item.id;\n            return (\n              <button\n                key={item.id}\n                onClick={() => handleNavigation(item.id)}\n                className={`w-full text-left px-3 py-2 rounded-lg text-sm transition-colors ${\n                  isActive\n                    ? 'bg-blue-100 text-blue-700 font-medium'\n                    : 'text-gray-600 hover:bg-gray-100 hover:text-gray-900'\n                }`}\n              >\n                <div className=\"flex items-center space-x-2\">\n                  <span className=\"text-lg\">{item.icon}</span>\n                  <div className=\"flex-1 min-w-0\">\n                    <div className=\"font-medium truncate\">{item.name}</div>\n                    <div className=\"text-xs opacity-75 truncate\">{item.description}</div>\n                  </div>\n                </div>\n              </button>\n            );\n          })}\n        </nav>\n\n        {/* Footer */}\n        <div className=\"p-4 border-t bg-gray-50\">\n          <div className=\"text-xs text-gray-500 text-center\">\n            <div>Enhanced with Figma & Stockbot</div>\n            <div>AI Assistant â€¢ Cross-page Filters â€¢ Drill-down</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"lg:pl-64\">\n        {/* Top Bar */}\n        <div className=\"sticky top-0 z-30 flex h-16 bg-white border-b border-gray-200 lg:hidden\">\n          <button\n            onClick={() => setSidebarOpen(true)}\n            className=\"px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500 lg:hidden\"\n          >\n            <span className=\"sr-only\">Open sidebar</span>\n            <svg className=\"h-6 w-6\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 6h16M4 12h16M4 18h16\" />\n            </svg>\n          </button>\n          <div className=\"flex-1 flex items-center px-4\">\n            <h1 className=\"text-lg font-semibold text-gray-900\">\n              {currentPage?.title || 'Scout Dashboard'}\n            </h1>\n          </div>\n        </div>\n\n        {/* Page Content */}\n        <main className=\"flex-1\">\n          {pageId ? (\n            <EnhancedV7Renderer pageId={pageId as string} />\n          ) : (\n            children || (\n              <div className=\"p-8 text-center\">\n                <div className=\"max-w-md mx-auto\">\n                  <div className=\"text-6xl mb-6\">ðŸ”­</div>\n                  <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Scout Dashboard v7</h1>\n                  <p className=\"text-gray-600 mb-8\">\n                    Advanced analytics dashboard with Figma design system integration, \n                    Stockbot-style financial analysis, cross-page filtering, and AI assistance.\n                  </p>\n                  \n                  <div className=\"grid grid-cols-1 gap-4\">\n                    <div className=\"p-4 bg-blue-50 rounded-lg\">\n                      <h3 className=\"font-semibold text-blue-900 mb-2\">ðŸŽ¨ Figma Integration</h3>\n                      <p className=\"text-sm text-blue-700\">\n                        Advanced chart components from r19 Data Visualization Kit\n                      </p>\n                    </div>\n                    \n                    <div className=\"p-4 bg-green-50 rounded-lg\">\n                      <h3 className=\"font-semibold text-green-900 mb-2\">ðŸ“ˆ Stockbot-Style Analysis</h3>\n                      <p className=\"text-sm text-green-700\">\n                        Financial market analysis without requiring Groq API\n                      </p>\n                    </div>\n                    \n                    <div className=\"p-4 bg-purple-50 rounded-lg\">\n                      <h3 className=\"font-semibold text-purple-900 mb-2\">ðŸ¤– AI Assistant</h3>\n                      <p className=\"text-sm text-purple-700\">\n                        Natural language chart generation and data insights\n                      </p>\n                    </div>\n                  </div>\n                  \n                  <div className=\"mt-8\">\n                    <button\n                      onClick={() => handleNavigation('transaction_trends')}\n                      className=\"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors\"\n                    >\n                      Get Started\n                    </button>\n                  </div>\n                </div>\n              </div>\n            )\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}"