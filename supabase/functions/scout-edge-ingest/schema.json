{
  "$id":"https://scout/edge-transaction.schema.json",
  "type":"object","required":["transaction_id","store","geo","ts_utc","tx_start_ts","tx_end_ts","request","items"],
  "properties":{
    "transaction_id":{"type":"string"},
    "store":{"type":"object","required":["id","tz_offset_min"],"properties":{"id":{"type":["string","number"]},"tz_offset_min":{"type":"integer"}}},
    "geo":{"type":"object","properties":{"region_id":{"type":["integer","null"]},"city_id":{"type":["integer","null"]},"barangay_id":{"type":["integer","null"]}}},
    "ts_utc":{"type":"string","format":"date-time"},
    "tx_start_ts":{"type":"string","format":"date-time"},
    "tx_end_ts":{"type":"string","format":"date-time"},
    "request":{"type":"object","required":["request_type","request_mode","payment_method"],"properties":{
      "request_type":{"enum":["branded","unbranded","point","indirect"]},
      "request_mode":{"enum":["verbal","pointing","indirect"]},
      "payment_method":{"enum":["cash","gcash","maya","credit","other"]},
      "gender":{"enum":["male","female","unknown"]},
      "age_bracket":{"enum":["18-24","25-34","35-44","45-54","55+","unknown"]}
    }},
    "items":{"type":"array","minItems":1,"items":{
      "type":"object","required":["category_name","product_name","qty","detection_method","confidence"],
      "properties":{
        "category_id":{"type":["integer","null"]},
        "category_name":{"type":"string"},
        "brand_id":{"type":["integer","null"]},
        "brand_name":{"type":["string","null"]},
        "product_name":{"type":"string"},
        "local_name":{"type":["string","null"]},
        "qty":{"type":"integer","minimum":1},
        "unit":{"type":"string"},
        "unit_price":{"type":["number","null"]},
        "total_price":{"type":["number","null"]},
        "detection_method":{"enum":["stt","vision","ocr","hybrid"]},
        "confidence":{"type":"number","minimum":0,"maximum":1}
      }
    }},
    "suggestion":{"type":["object","null"],"properties":{"offered":{"type":"boolean"},"accepted":{"type":"boolean"}}},
    "substitution":{"type":["object","null"],"properties":{"asked_brand_id":{"type":["integer","null"]},"final_brand_id":{"type":["integer","null"]}}},
    "amounts":{"type":["object","null"],"properties":{"transaction_amount":{"type":["number","null"]},"price_source":{"enum":["edge","catalog","pos","unknown"]}}}
  }
}